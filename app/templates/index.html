{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{% block title %}Flasky{% endblock %}

{% block css_styles %}
<style type="text/css">
    .text{
        margin-right:4%;
        width:35%;
        overflow:auto;
        display:inline
    }
    .comment_text{
        width:20%;
        overflow:auto;
        display:inline
    }
    #text_lines{
        overflow: auto;
        height: 300px;
    }
</style>
{% endblock %}

{% block page_content %}
    <div id="uploadForm">
        <input id="uploadFile" type="file" name=file/>
        <button id="uploadBtn" type="button">上传</button>
    </div>
<div id="edit_area" style=";margin-bottom:10px;">
    <textarea id="original_text" class="form-control text" rows="10">
        This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text.
    </textarea>
    <textarea id="vernacular_text" class="form-control text" rows="10">
        This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text.
    </textarea>
    <textarea id="comment" class="form-control comment_text " rows="10">
        This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text. This is some text.
    </textarea>
</div>
<h3>生成表格</h3>
<div id="text_lines" >
     <table class="table table-striped table-condensed">
        <thead>
            <tr>
                <td>原文</td>
                <td>白话文</td>
                <td>注释</td>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>This is some text.</td>
                <td>This is some text.</td>
                <td>This is some text.</td>
            </tr>
            <tr>
                <td>This is some text.</td>
                <td>This is some text.</td>
                <td>This is some text.</td>
            </tr>
            <tr>
                <td>This is some text.</td>
                <td>This is some text.</td>
                <td>This is some text.</td>
            </tr>
            <tr>
                <td>This is some text.</td>
                <td>This is some text.</td>
                <td>This is some text.</td>
            </tr>
            <tr>
                <td>This is some text.</td>
                <td>This is some text.</td>
                <td>This is some text.</td>
            </tr>
            <tr>
                <td>This is some text.</td>
                <td>This is some text.</td>
                <td>This is some text.</td>
            </tr>
            <tr>
                <td>This is some text.</td>
                <td>This is some text.</td>
                <td>This is some text.</td>
            </tr>
            <tr>
                <td>This is some text.</td>
                <td>This is some text.</td>
                <td>This is some text.</td>
            </tr>
        <tr>
                <td>This is some text.</td>
                <td>This is some text.</td>
                <td>This is some text.</td>
            </tr>
            <tr>
                <td>This is some text.</td>
                <td>This is some text.</td>
                <td>This is some text.</td>
            </tr>
            <tr>
                <td>This is some text.</td>
                <td>This is some text.</td>
                <td>This is some text.</td>
            </tr>
            <tr>
                <td>This is some text.</td>
                <td>This is some text.</td>
                <td>This is some text.</td>
            </tr>
            <tr>
                <td>This is some text.</td>
                <td>This is some text.</td>
                <td>This is some text.</td>
            </tr>
        </tbody>
    </table>
</div>

{% endblock %}

{% block subscripts %}
<script>
$(document).ready(function(){
  $("#original_text").scroll(function() {
     var height = $(this)[0].scrollHeight - $(this).outerHeight();
     var current = $(this).scrollTop()/height;
     scrollByOriginal_text("vernacular_text",current);
     scrollByOriginal_text("comment",current);
     scrollByOriginal_text("text_lines",current);
  });
  $("#uploadBtn").on('click', function(){
        var formData = new FormData();
        formData.append('file', $('#uploadFile')[0].files[0]);
        $.ajax({
            url: "{{ url_for('main.upload') }}",
            type: 'POST',
            cache: false,
            data: formData,
            processData: false,
            contentType: false
        }).done(function(res) {
            var data = JSON.parse(res)
            if(data.success == 'true'){
                var origin = JSON.stringify(data.parts.origin).replace(/\\r\\n/g, '<br/>');
                var vernacular = JSON.stringify(data.parts.vernacular).replace(/\\r\\n/g, '<br/>');
                var comment = JSON.stringify(data.parts.comment).replace(/\\r\\n/g, '<br/>');
                $("#original_text").html(origin);
                $("#vernacular_text").html(vernacular);
                $("#comment").html(comment);
            } else {
                alert(data.message);
            }
        }).fail(function(res) {});
    })
});
function scrollByOriginal_text(id,current){
    var elem = $(`#${id}`);
    var maxHeight = elem[0].scrollHeight -elem.outerHeight();
    elem.scrollTop(maxHeight*current);
}
</script>
{% endblock %}
